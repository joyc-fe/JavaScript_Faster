### 构建并部署高性能JavaScript应用

在设计和开发阶段做的一些优化可以更有效的提高Web应用，但是在构建和部署阶段也很重要且容易被忽略。

#### 1. 自动化构建工具

对于需要反复执行的任务，比如压缩、编译、单元测试等，可以使用自动化构建工具完成，简化工作。

- Apache Ant
- Gulp
- Grunt

使用构建工具可以合并多个文件，减少HTTP请求数。

#### 2. 压缩JavaScript

压缩JavaScript是移除JavaScript文件中与运行无关的部分，比如注释和不必要的恐怖字符。

压缩工具：

- JSMin
- YUI Compressor

YUI Compressor提供了所有类型的智能操作，除了移出注释和空格还提供如下功能：

- 将局部变量替换成更短的形式
- 尽可能将方括号表示法替换为点表示法
- 极可能去掉直接量属性名的引号
- 替换字符串中的转义符
- 合并常量

#### 3. HTTP压缩

使用HTTP压缩将资源压缩后传输。

当浏览器发送请求时，会发送一个Accept-Encoding的HTTP头，以告诉服务器支持的编码类型，值可能为gzip,compress,deflate等。

服务器根据这些值对资源进行压缩，然后使用HTTP头中的Content-Encoding告诉浏览器压缩类型。

Gzip是当前常用的编码方式，但是Gzip主要适用于文本，比如JavaScript文件、css等。而对于其他文件比如图片,PDF等不应该使用Gzip压缩。因为图片,PDF本身已经被压缩过，再压缩只会浪费CPU资源。

#### 4. 缓存资源

缓存HTTP组件可以极大提高用户体验，缓存适用于所有静态内容，比如图片、JavaScript文件等。Web服务器通过ExpiresHTTP头告诉浏览器资源应该被缓存多长时间，它的值是一个时间戳。

使用缓存又一个缺点：当应用升级时，需要确保用户下载到最新的静态内容。这个问题可以通过对静态资源进行重命名解决。比如在资源URL后追加一个版本号或开发编号，也可以是一个时间戳。

#### 5. 使用内容分发网络(CDN)

CDN是在互联网上按照地理位置分布计算机网络，负责传递内容给终端用户，使用CDN的主要原因是增强Web应用的可靠性和可扩展性，也能提高性能。通过向地理位置最近的用户传输内容，CDN可以减少网络延迟。

#### 小结

- 合并JavaScript文件减少HTTP请求数
- 使用YUI Compressor压缩JavaScript文件
- 在服务器端使用Gzip压缩
- 通过HTTP响应头缓存资源，并添加时间戳以避免缓存不能被及时更新
- 使用CDN